{% extends "base.jinja" %}

{% block content %}
RUN pip --no-cache-dir install --upgrade http://download.pytorch.org/whl/{{ cuda_version }}/torch-{{ _version }}-{{ cpver }}-{{ _platform }}_x86_64.whl \
    tensorboardX{% if _vision_version is defined %} \
    torchvision=={{ _vision_version }}
{% else %}
# install torch vision from source for dataloader bug fix
# ref: https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix/issues/63
RUN git clone https://github.com/pytorch/vision \
    && cd vision \
    && git checkout 7492fae4c2cd16fb2783dce7e7583d7245cfbe92 \
    && python setup.py install \
    && cd .. \
    && rm -rf vision
{% endif %}

{%- endblock %}
